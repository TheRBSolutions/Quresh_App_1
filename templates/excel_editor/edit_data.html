{% extends "base.html" %}

{% block content %}
<h2>Edit Excel Data</h2>
<div id="excel-data"></div>
<button onclick="saveData()">Save to Database</button>

<script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css" rel="stylesheet">

<script>
    const data = JSON.parse('{{ data|escapejs }}');
    const container = document.getElementById('excel-data');
    const hot = new Handsontable(container, {
        data: data,
        rowHeaders: true,
        colHeaders: true,
        contextMenu: true,
        licenseKey: 'non-commercial-and-evaluation'
    });

    function saveData() {
        const updatedData = hot.getData();
        fetch('{% url "excel_editor:save_data" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: 'data=' + encodeURIComponent(JSON.stringify(updatedData))
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert('Data saved successfully!');
            } else {
                alert('Error saving data.');
            }
        });
    }
</script>
{% endblock %}